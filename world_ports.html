<script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
<script src="/datamaps.world.min.js"></script>
<div id="container" style="position: relative; height: 480px; width: 600px; display: inline-block;"></div>
<div id="histogram" style="position: relative; height: 480px; width: 600px; display: inline-block;"></div>
<script>
var data;

var bubble_map = new Datamap({
    element: document.getElementById("container"),
    geographyConfig: {
        popupOnHover: false,
        highlightOnHover: false
    },
    fills: {
        defaultFill: '#ABDDA4',
        Port: 'blue',
    },
    setProjection: function(element) {
        var projection = d3.geo.mercator()
        .scale(80)
        .translate([element.offsetWidth / 2, element.offsetHeight / 2]);

        var path = d3.geo.path().projection(projection);

        return {path: path, projection: projection};
    }
});

d3.csv("ports.csv")
.row(function (row){
  return {
    name: row.Port,
    radius: 5,
    country: row.Country,
    yield: row.Count,
    latitude: row.Lat,
    longitude: row.Lon,
    fillKey: row.Rank,
    id: row.Rank
  }
})
.get(function(error, rows)
{
    bubble_map.bubbles(
        rows,
        {
            popupTemplate: function(geo, data)
            {
                return '<div class="hoverinfo"> Yield:' + data.name + ', Count ' + data.yield
            }
        }
    );
});

</script>
